/** * Created by Zhang Haijun on 2016/10/8. */app.controller('TopologyShowCtrl', ['$scope', 'httpLoad', '$rootScope','$modal',	function($scope, httpLoad, $rootScope, $modal) {		$rootScope.moduleTitle = '应用中心 > 拓扑展示';//定义当前页		$rootScope.link = '/statics/css/topology.css';//引入页面样		var Topology = function(){			this.Init();			this.LoadData();		};		Topology.prototype = {			Init:function(){				var canvas = $('#canvas')[0];//获取画布元素				//设置画布元素的高度和宽度				canvas.height = window.innerHeight - 94;				canvas.width = window.innerWidth - 290;				this.stage = new JTopo.Stage(canvas);//创建一个舞台对象				//显示工具栏				showJTopoToobar(this.stage);				//启用鹰眼				this.stage.eagleEye.visible = true;				//创建一个场景对象				this.scene = new JTopo.Scene();				this.scene.background = '/statics/img/topology/bg.jpg';			},			LoadData:function () {				var that = this;				httpLoad.loadData({					url:'/topology/data',					data:{						simple:true					},					success:function(data){						if(data.success){							var nodes = data.data.nodes;							var links = data.data.links;							that.DrawTopology(nodes,links);						}					}				});			},			DrawTopology:function (nodes,links) {				var map = {};var that = this;				//定义线条颜色				var color = {					primary:'0,174,239',					warning:'250,215,51',					danger:'240,80,80'				}				//告警信息展示				var showAlarm = function(node,alarm){					setInterval(function(){						if(node.alarm){							delete node.alarm;						}else{							node.alarm = alarm;						}					}, 1000);				}				//绘制节点				var drawNode = function(nodeObj){					var node = new JTopo.Node();					node.fontColor = '85,85,85';					node.setImage('/statics/img/topology/' + nodeObj.img, true);					node.setLocation(nodeObj.location[0], nodeObj.location[1]);					if(nodeObj.alarm) showAlarm(node,nodeObj.alarm);					if(nodeObj.alarms) node.alarm = nodeObj.alarms;					map[nodeObj.nodeId] = node;					that.scene.add(node);					node.mouseover(function(){						this.text = nodeObj.name;					});					node.mouseout(function(){						this.text = null;					});				}				for(var i = 0; i < nodes.length; i++){					drawNode(nodes[i]);				}				//绘制线条				var drawLink = function (linkObj) {					var link = new JTopo.Link(map[linkObj.from], map[linkObj.to],linkObj.name);					link.strokeColor =  color[linkObj.level];					link.lineWidth = 3;					that.scene.add(link);				}				for(var j = 0; j < links.length; j++){					drawLink(links[j]);				}				this.stage.add(this.scene);				//全自动树形布局				// this.scene.doLayout(JTopo.layout.TreeLayout('down', 30, 107));			}		};		new Topology();	}]);